version: '3'
services:
  mongodb:
      hostname: mongodb
      container_name: mongodb
      image: bitnami/mongodb:latest
      expose:
        - 27017
      ports:
        - 27017:27017
      volumes:
        - /tmp/data/db:/data/db
      environment:
        - MONGODB_USERNAME=promoManager
        - MONGODB_PASSWORD=password
        - MONGODB_DATABASE=promoManager
        - MONGODB_ROOT_PASSWORD=password
      networks:
        - devit-network

  zookeeper:
    container_name: zookeeper
    hostname: zookeeper
    image: wurstmeister/zookeeper:latest
    ports:
      - 2181:2181
    networks:
      - devit-network

  kafka:
    container_name: kafka
    hostname: kafka
    image: wurstmeister/kafka:latest
    expose:
      - 9092
    ports:
      - 9092:9092
    environment:
      # - KAFKA_ADVERTISED_HOST_NAME: localhost
      # - KAFKA_ADVERTISED_LISTENERS: localhost:9092
      - KAFKA_ADVERTISED_HOST_NAME: kafka
      - KAFKA_ADVERTISED_LISTENERS: kafka:9092
      - KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - devit-network

  configuration-server:
    container_name: configuration-server
    hostname: configuration-server
    image: dev-it/devit-configuration-server:latest
    expose:
      - 8888
    ports:
      - 8888:8888
    networks:
      - devit-network
    env_file:
      - .configuration_server_env
    environment:
      - eureka.client.serviceUrl.defaultZone=http://eureka:8761/eureka/
    depends_on:
      - eureka
    links:
      - eureka
    logging:
      driver: json-file

  eureka:
    container_name: eureka
    hostname: eureka
    image: dev-it/devit-eureka-server:latest
    expose:
      - 8761
    ports:
      - 8761:8761
    networks:
      - devit-network
    logging:
        driver: json-file

networks:
  devit-network:
    driver: bridge